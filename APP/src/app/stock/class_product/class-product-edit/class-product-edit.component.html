  <ol class="breadcrumb float-right" *ngIf="class_product">
    <li class="breadcrumb-item"><a routerLink="/">Accueil</a></li>
    <li class="breadcrumb-item active" routerLink="/stock/classProducts">
      Stock de produit
    </li>
    <li *ngIf="class_product._id"  class="breadcrumb-item active">
      {{class_product._id}}
    </li>

    <li *ngIf="!class_product._id"  class="breadcrumb-item active">
      Création d'un Stock de produit
    </li>
  </ol>
  <mat-expansion-panel style="overflow: auto " expanded=true class="card base-color-light" *ngIf="class_product" fxLayout="column">
    <mat-expansion-panel-header fxFlex="5" class="lead" fxLayout="column" fxLayout="center">


        <mat-panel-title>
          <p class="h4">
            <span *ngIf="!class_product._id">Création d'un Stock de produit</span>
            <span *ngIf="class_product._id"> Stock de produit  <span class="alert-danger h6" *ngIf="class_product.quantity==0">[ Stock épuisé  ]</span></span>


          </p>
        </mat-panel-title>

        <mat-panel-description>

          <p class="h4"> Informations principales </p>
        </mat-panel-description>







    </mat-expansion-panel-header>
    <div class="content">
      <div *ngIf="feedback" class="alert alert-{{feedback.type}}">{{ feedback.message }}</div>
      <form  #editForm="ngForm" (ngSubmit)="save()">



        <div class="form-group">
          <mat-form-field class="gs-mat-field" fxFlex="100">

            <input matInput class="form-control" placeholder="Id" name="Id"
                   type="text"  [(ngModel)]="class_product._id"    readonly  >

          </mat-form-field>
        </div>


        <div class="form-group">
          <mat-form-field  class="gs-mat-field h4" fxFlex="100">
            <input matInput class="form-control" placeholder="Produit" name="Product"
                   [matAutocomplete]="autoProduct" [formControl]="productInput"  [readonly]="class_product._id" (blur)="checkProduct()">
          </mat-form-field>
          <mat-autocomplete #autoProduct="matAutocomplete" [displayWith]="displayProduct"
          (optionSelected)="productClick($event)">
          <mat-option *ngIf="isLoadingProduct" class="is-loading">
            <mat-spinner diameter="50"></mat-spinner>
          </mat-option>
          <ng-container *ngIf="!isLoadingProduct">
            <mat-option *ngFor="let product of filteredProductList" [value]="product">
                <span>{{
                  product.name}}</span>
            </mat-option>
          </ng-container>
          </mat-autocomplete>
        </div>



        <div class="form-group">
          <mat-form-field class="gs-mat-field" fxFlex="100">

            <input matInput class="form-control" placeholder="Nom de la classe " name="Label"
                   type="text"  [(ngModel)]="class_product.label"    >

          </mat-form-field>
        </div>



        <div class="form-group">
          <mat-form-field class="gs-mat-field" fxFlex="100">

            <input matInput class="form-control" placeholder="Prix unitaire de vente" name="UnitPrice"
                   type="number"  [(ngModel)]="class_product.unit_price"    >

          </mat-form-field>
        </div>



        <div class="form-group">
          <mat-form-field class="gs-mat-field" fxFlex="100">

            <input matInput [matDatepicker]="datepicker" placeholder="Date d'arrivée" [(ngModel)]="class_product.date_intrance" name="DateIntrance"                                           required   >
            <mat-datepicker-toggle matSuffix [for]="datepicker"></mat-datepicker-toggle>
            <mat-datepicker touchUi="true" #datepicker></mat-datepicker>

          </mat-form-field>
        </div>



        <div class="form-group">
          <mat-form-field class="gs-mat-field" fxFlex="100">

            <input matInput class="form-control" placeholder="quantité" name="Quantity"
                   type="number"  [(ngModel)]="class_product.quantity"    readonly  >

          </mat-form-field>
        </div>





        <button type="submit" class="btn btn-primary" [disabled]="!editForm.form.valid">Enregistrer</button>
        <button type="button" class="btn btn-secondary" (click)="cancel()">Annuler</button>
      </form>
    </div>
  </mat-expansion-panel>


  <mat-expansion-panel style="overflow: auto " expanded=true class="card base-color-light" *ngIf="class_product&&class_product._id" fxLayout="column">
    <mat-expansion-panel-header fxFlex="5" class="lead" fxLayout="column" fxLayout="center">


      <mat-panel-title>
        <p class="h4">
       <span>Statistiques de vente</span>

        </p>
      </mat-panel-title>

      <mat-panel-description>

        <p class="h4"> Ventes réalisées et bénéfices </p>
      </mat-panel-description>
    </mat-expansion-panel-header>

    <app-sale-unit *ngIf="sale" [productMode]=true [saleMode]=false [sale]="sale" class="stock_benef"></app-sale-unit>

  <mat-card *ngIf="command_unit" class="stock_benef">
    <mat-card-header>

      <p class="h4">Commande et bénéfices <span class="alert-danger h6" *ngIf="class_product.quantity==0">[ Stock épuisé  ]</span> </p>


    </mat-card-header>
    <mat-card-content fxLayout="row" fxLayoutAlign="space-between" >

      <mat-form-field>
        <mat-label>
          Date de la livraison
        </mat-label>
        <input readonly matInput [value]="command_unit.date_delivrance |date">

      </mat-form-field>






      <mat-form-field>
        <mat-label>
         Quantité initiale
        </mat-label>
        <input matInput readonly [value]="command_unit.quantity">
      </mat-form-field>


      <mat-form-field>
        <mat-label>
          Quantité restante
        </mat-label>
        <input matInput readonly [value]="class_product.quantity">
      </mat-form-field>



      <mat-form-field>
        <mat-label>
          Prix unitaire d'achat
        </mat-label>
        <input matInput readonly [value]="command_unit.unit_price|currency:'FCFA':'symbol':'1.0-0':'fr'">
      </mat-form-field>


      <mat-form-field>
        <mat-label>
          Montant total de l'achat
        </mat-label>
        <input matInput readonly [value]="command_unit.quantity*command_unit.unit_price|currency:'FCFA':'symbol':'1.0-0':'fr'">

      </mat-form-field>






    </mat-card-content>

    <hr size="20px">
    <div fxLayout  fxLayoutAlign="space-between" >
      <mat-form-field fxFlex="30">
        <mat-label>
          Bénéfices actuels hors crédit
        </mat-label>
        <input matInput readonly  [value]="
        (sale?( sale.paid_amount-(command_unit.quantity-class_product.quantity)*command_unit.unit_price):0)|currency:'FCFA':'symbol':'1.0-0':'fr'">

      </mat-form-field>




      <mat-form-field fxFlex="30">
        <mat-label>
          Bénéfices actuels -crédits compris
        </mat-label>
        <input matInput readonly  [value]="
        (sale?( (sale.amount)-(command_unit.quantity-class_product.quantity)*command_unit.unit_price):0)|currency:'FCFA':'symbol':'1.0-0':'fr'">

      </mat-form-field>





      <mat-form-field fxFlex="30">
        <mat-label>
          Bénéfices prévisionnels Supplémentaires
        </mat-label>
        <input matInput readonly [value]="
        ((class_product.quantity)*class_product.unit_price-(class_product.quantity)*command_unit.unit_price)|currency:'FCFA':'symbol':'1.0-0':'fr'" >

      </mat-form-field>

    </div>











  </mat-card>




  </mat-expansion-panel>
